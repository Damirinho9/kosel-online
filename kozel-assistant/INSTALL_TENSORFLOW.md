# Установка TensorFlow.js для ML функций

## ⚠️ КРИТИЧЕСКАЯ ПРОБЛЕМА: TensorFlow.js несовместим с Manifest V3

**Стандартный TensorFlow.js НЕ РАБОТАЕТ в Chrome Extension Manifest V3.**

### Проблема:

TensorFlow.js использует `eval()` и `new Function()`, что **категорически запрещено** Content Security Policy в Manifest V3.

**Даже после установки вы увидите ошибку:**
```
Uncaught EvalError: Evaluating a string as JavaScript violates
the following Content Security Policy directive
```

Это **известная проблема**: [TensorFlow.js Issue #5429](https://github.com/tensorflow/tfjs/issues/5429)

---

## ✅ Хорошая новость: Расширение полностью работает без TensorFlow.js!

**Все функции доступны:**
- ✅ Адаптивные стратегии AI V2.0
- ✅ Профилирование игроков
- ✅ Анализ ситуации
- ✅ Рекомендации карт
- ✅ Статистика игр

**Недоступно только:**
- ❌ ML предсказания на основе обученной нейронной сети

### Рекомендация:

**Используйте расширение как есть** - AI V2.0 работает отлично без ML. Нейронная сеть была экспериментальной функцией и не является критичной.

---

## Альтернативные решения (будущее)

1. **Ожидание обновления TensorFlow.js**
   - Команда TensorFlow.js работает над версией для Manifest V3
   - Следите за [Issue #5429](https://github.com/tensorflow/tfjs/issues/5429)

2. **Модульная версия** (требует разработки)
   - @tensorflow/tfjs-core + WASM backend
   - Нужно переписать загрузку

3. **Серверный ML** (требует сервера)
   - Модель на сервере
   - Расширение делает API запросы

---

## Если всё равно хотите попробовать установить (не сработает)

**Предупреждение:** Даже после установки TensorFlow.js НЕ БУДЕТ РАБОТАТЬ из-за CSP.

## Пошаговая инструкция

### Способ 1 (рекомендуется):

1. **Откройте в браузере Chrome:**
   ```
   https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js
   ```

2. **Нажмите Ctrl+S (или Cmd+S на Mac)** для сохранения

3. **ВАЖНО: Сохраните файл КАК ЗАМЕНУ существующего:**
   - Выберите папку: `kozel-assistant/lib/`
   - Имя файла: `tf.min.js` (точно так!)
   - Согласитесь заменить существующий файл
   - Проверьте размер: должно быть **~1.4-1.8 MB** (не 2 KB!)

4. **Перезагрузите расширение:**
   - Откройте `chrome://extensions/`
   - Нажмите кнопку обновления расширения

### Способ 2 (альтернативные источники):

Если первый способ не работает, попробуйте скачать с альтернативных CDN:

1. **unpkg.com:**
   ```
   https://unpkg.com/@tensorflow/tfjs@4.11.0/dist/tf.min.js
   ```

2. **GitHub Releases:**
   ```
   https://github.com/tensorflow/tfjs/releases/download/tfjs-v4.11.0/tf.min.js
   ```

## Проверка установки

После установки проверьте:

1. **Размер файла:**
   ```
   lib/tf.min.js  (~1.8 MB, НЕ 2 KB!)
   ```

2. **Откройте kozel-online.com**

3. **Проверьте консоль (F12):**
   ```
   ✓ Должны увидеть:
   [ML Offscreen] ✓ TensorFlow.js загружен: 4.11.0
   [ML Offscreen] Инициализация ML...

   ❌ Если видите красный блок с инструкциями:
   Файл не установлен или это всё ещё заглушка (2 KB)
   ```

## Почему нужна ручная установка?

- Chrome Extension Manifest V3 требует локальные файлы
- CSP (Content Security Policy) блокирует загрузку скриптов с внешних CDN
- Это требование безопасности браузера Chrome
- Автоматическая загрузка технически невозможна

## Что если не установить?

Если файл отсутствует или не заменён:

✅ **Расширение работает полностью!**
- Основной AI V2.0 работает (адаптивные стратегии)
- Профилирование игроков работает
- Все рекомендации работают

❌ **Не будет:**
- Нейронная сеть (ML предсказания)

Расширение будет показывать предупреждение в консоли, но продолжит работать.

## Размер файлов

- TensorFlow.js: ~1.8 MB
- Общий размер расширения с TensorFlow.js: ~2.3 MB
- Заглушка (если не установить): 2 KB

---

**Важно:** TensorFlow.js нужен только для ML функций (нейронная сеть). Основной AI отлично работает без него!
